<!DOCTYPE html>
<html>
<meta charset="utf-8"/>
  <head>
    <script src="jspsych.js"></script>
    <script src="plugins/jspsych-instructions.js"></script>
    <script src="plugins/jspsych-audio-button-response.js"></script>
    <script src="plugins/jspsych-html-button-response.js"></script>
    <script src="plugins/jspsych-survey-text.js"></script>
    <script src="audiopreload.js"></script>
    <link rel="stylesheet" href="jspsych.css"></link>
  </head>
  <body></body>
  <script>

  var timeline = [];

	   /* Welcome and IRB */

    var welcome_block = {
    type: 'instructions',
    pages: ["<p>Welcome to this pilot experiment!</p>" +
	    "<p> Please click NEXT to start the survey!</p>",
	
          "<p>Before collecting any data we are required to obtain a confirmation of consent all for participants.</p>" 
    	+ "<p>Please read the following statement: </p>" 
        + "<p>This experiment will ask you to listen to small musical excerpts then respond based on what you hear. The experiment is currently designed so that only trained musicians that understand moveable-do solfege can participate. You may choose not to participate or to withdraw from the study at any time without penalty or loss of any benefit.  "
   	+ "All data will be made anonymous and all efforts will be made to keep data private and secure. For questions concerning participant rights, feel free"
    	+ " to contact Dr. Dennis Landin, chair of the Institutional Review Board at either (225)-578-8692 or irb@lsu.edu.</p>"
        + "<p> If you are willing to partake in this study, please press NEXT and the survey will begin." ,

      	   '<p>Thank you for choosing to participate in this survey!</p>'  
    	        + "<p>Please answer the following survey questions about your aural skills background.</p>"],

    show_clickable_nav: true
  }

    timeline.push(welcome_block);

  /* Demographic Information Here */


// defining groups of questions that will go together.
var survey_trial = {
  type: 'survey-text',
  questions: [{prompt: "How many years old are you?"}, {prompt: "What is your educational status? (e.g. No Higher Education, Bachelor's, Graduate Student, Finished Terminal Degree, Associate Professor)"}, {prompt: "Which type of syllable system do you prefer to use? (e.g. Moveable-Do, Fixed-Do, La-Based Minor, Numbers"}, {prompt:"Do you have absolute pitch?"}, {prompt: "How many weeks of aural skills training have you completed? (1 Semester = 15 weeks, 4 semesters = 60 weeks)"}, {prompt: "How many years have you taught aural skills at the post-secondary level? (If you are an undergraduate student, please respond with 0)"}]
};

timeline.push(survey_trial);


  var visual_melody_instructions_block = {
    type: 'instructions',
    pages: ["<p>Thank you for completing the first part of this experiment!</p>" +
	    "<p>Take a second to rest if you need, the NEXT portion of this survey will ask you to complete a very specific musical task.</p>",
          "<p>In this experiment you will complete 39 trials of the same task.</p>" 
    	+ "<p>You will hear a short cadence played on the piano followed by a musical tone. </p>" 
        + "<p>After hearing the tone, you will be asked to respond which tone you heard in moveable do notation as quickly and accurately as possible.</p>"         
        + "<p>The next section will provide an example so you understand the task.</p>",
	"<p>If you are ready to begin the example, please press NEXT.</p>"],

    show_clickable_nav: true
		};

timeline.push(visual_melody_instructions_block);

  timeline.push({
    type: 'audio-button-response',
    stimulus: 'stimuli/c-do.mp3',
    choices: ['Do |  1', 'Ra | b2', 'Re | 2', 'Me | b3', 'Mi | 3', 'Fa | 4', 'Fi | #4', 'Sol | 5', 'Le | b6', 'La | 6', 'Te | b7', 'Ti | 7', 'Do | 1'],
    prompt: "<p>Which tone was played after the cadence?</p><p>The answer is 'Do' or '1'.</p>"
  });

  timeline.push({
    type: 'audio-button-response',
    stimulus: 'stimuli/a-le.mp3',
    choices: ['Do |  1', 'Ra | b2', 'Re | 2', 'Me | b3', 'Mi | 3', 'Fa | 4', 'Fi | #4', 'Sol | 5', 'Le | b6', 'La | 6', 'Te | b7', 'Ti | 7', 'Do | 1'],
    prompt: "<p>Which tone was played after the cadence?</p><p>The answer is 'Le' or 'b6'.</p>"
  });

  var check = {
    type: 'instructions',
    pages: ["<p>If you understand the task, please begin!</p>" +
	    "<p>If you do not understand the task, please close the web browser. Feel free to try the task, but participants who score below a certain accuracy threshold will be removed from the analysis.</p>",
          "<p>The 39 trials will begin as soon as you press NEXT.</p>" 
    	+ "<p>Trials are limited to 20 seconds, so the maximum amount of time it will take to complete this is experiment is 13 minutes. (20 seconds * 39 Stimuli = 780 seconds = 13 minutes)</p>" 
        + "<p>Thank you very much for your time!</p>"],

    show_clickable_nav: true
		};

timeline.push(check);

var main_loop = {
	timeline: [
		{
    type: 'audio-button-response',
    stimulus: jsPsych.timelineVariable('melody'),
    choices: ['Do |  1', 'Ra | b2', 'Re | 2', 'Me | b3', 'Mi | 3', 'Fa | 4', 'Fi | #4', 'Sol | 5', 'Le | b6', 'La | 6', 'Te | b7', 'Ti | 7', 'Do | 1'],
    trial_duration: 20000,
    response_ends_trial: false,
    prompt: "<p>Which tone was played after the cadence?</p>"

		}
	],
	timeline_variables : [
	{ melody: 'stimuli/a-do.mp3' },
	{ melody: 'stimuli/a-do8.mp3' },
	{ melody: 'stimuli/a-fa.mp3' },
	{ melody: 'stimuli/a-fi.mp3' },
	{ melody: 'stimuli/a-la.mp3' },
	{ melody: 'stimuli/a-le.mp3' },
	{ melody: 'stimuli/a-me.mp3' },
	{ melody: 'stimuli/a-mi.mp3' },
	{ melody: 'stimuli/a-ra.mp3' },
	{ melody: 'stimuli/a-re.mp3' },
	{ melody: 'stimuli/a-sol.mp3' },
	{ melody: 'stimuli/a-te.mp3' },
	{ melody: 'stimuli/a-ti.mp3' },
	{ melody: 'stimuli/c-do.mp3' },
	{ melody: 'stimuli/c-do8.mp3' },
	{ melody: 'stimuli/c-fa.mp3' },
	{ melody: 'stimuli/c-fi.mp3' },
	{ melody: 'stimuli/c-la.mp3' },
	{ melody: 'stimuli/c-le.mp3' },
	{ melody: 'stimuli/c-me.mp3' },
	{ melody: 'stimuli/c-mi.mp3' },
	{ melody: 'stimuli/c-ra.mp3' },
	{ melody: 'stimuli/c-re.mp3' },
	{ melody: 'stimuli/c-sol.mp3' },
	{ melody: 'stimuli/c-ti.mp3' },
	{ melody: 'stimuli/e-di.mp3' },
	{ melody: 'stimuli/e-do.mp3' },
	{ melody: 'stimuli/e-do8.mp3' },
	{ melody: 'stimuli/e-fa.mp3' },
	{ melody: 'stimuli/e-fi.mp3' },
	{ melody: 'stimuli/e-la.mp3' },
	{ melody: 'stimuli/e-le.mp3' },
	{ melody: 'stimuli/e-me.mp3' },
	{ melody: 'stimuli/e-mi.mp3' },
	{ melody: 'stimuli/e-ra.mp3' },
	{ melody: 'stimuli/e-re.mp3' }, 
	{ melody: 'stimuli/e-sol.mp3' },
	{ melody: 'stimuli/e-te.mp3' },
	{ melody: 'stimuli/e-ti.mp3' },
	{ melody: 'stimuli/c-do.mp3' },
	{ melody: 'stimuli/c-do.mp3' }
],
	randomize_order: true

}

timeline.push(main_loop);


/* This is where second wave will go  */



/* This is where second wave will end * / 

var subject_id = Math.floor(Math.random()*100000);
        jsPsych.data.addProperties({
                     subject: subject_id,
                });

    var bye_block = {
    type: 'instructions',
    pages: ["<p>Thank you very much for taking part in this !</p><p>PLEASE REMEMBER TO PRESS NEXT BELOW TO ENSURE YOUR DATA IS SAVED.</p><p>If you have any questions or would like to talk about this research, please email David at davidjohnbaker1 [at] gmail DOT com.</p>"],

    show_clickable_nav: true
  }

    timeline.push(bye_block);

/* Online Data Save Function */

function saveData(name, data){
  var xhr = new XMLHttpRequest();
  xhr.open('POST', 'write_data.php'); // 'write_data.php' is the path to the php file described above.
  xhr.setRequestHeader('Content-Type', 'application/json');
  xhr.send(JSON.stringify({filename: name, filedata: data}));
}


jsPsych.init({
   timeline: timeline,
   preload_audio:audio,
   on_finish: function() { saveData(subject_id,jsPsych.data.get().csv());}
    });

/* Local Save 
  jsPsych.init({
    timeline: timeline,
    preload_audio: audio,
    use_webaudio: true,
    on_finish: function(){jsPsych.data.displayData();}
  });
*/

  </script>
</html>

