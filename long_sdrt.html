<!DOCTYPE html>
<html>
<meta charset="utf-8"/>
  <head>
    <script src="jspsych.js"></script>
    <script src="plugins/jspsych-instructions.js"></script>
    <script src="plugins/jspsych-audio-button-response.js"></script>
    <script src="plugins/jspsych-html-button-response.js"></script>
    <script src="poldrack_plugins/jspsych-single-stim-button.js"></script>
    <script src="plugins/jspsych-survey-text.js"></script>
    <script src="audiopreload.js"></script>
    <link rel="stylesheet" href="jspsych.css"></link>
  </head>
  <body></body>
  <script>

/* Creates Blank Timeline to Push to */ 

  var timeline = [];

var response_grid =
  '<div class = numbox>' +
  '<button id = button_1 class = "square num-button" onclick = "recordClick(this)"><div class = content><div class = numbers>1</div></div></button>' +
  '<button id = button_2 class = "square num-button" onclick = "recordClick(this)"><div class = content><div class = numbers>2</div></div></button>' +
  '<button id = button_3 class = "square num-button" onclick = "recordClick(this)"><div class = content><div class = numbers>3</div></div></button>' +
  '<button id = button_4 class = "square num-button" onclick = "recordClick(this)"><div class = content><div class = numbers>4</div></div></button>' +
  '<button id = button_5 class = "square num-button" onclick = "recordClick(this)"><div class = content><div class = numbers>5</div></div></button>' +
  '<button id = button_6 class = "square num-button" onclick = "recordClick(this)"><div class = content><div class = numbers>6</div></div></button>' +
  '<button id = button_7 class = "square num-button" onclick = "recordClick(this)"><div class = content><div class = numbers>7</div></div></button>' +
  '<button id = button_8 class = "square num-button" onclick = "recordClick(this)"><div class = content><div class = numbers>8</div></div></button>' +
  '<button id = button_9 class = "square num-button" onclick = "recordClick(this)"><div class = content><div class = numbers>9</div></div></button>' +
  '<button class = clear_button id = "ClearButton" onclick = "clearResponse()">Clear</button>' +
  '<button class = submit_button id = "SubmitButton">Submit Answer</button></div>'


/* Welcome and IRB */

    var welcome_block = {
    type: 'instructions',
    pages: ["<p>Welcome to this experiment!</p>" +
	    "<p> Please click NEXT to start the survey!</p>",
	
          "<p>Before collecting any data we are required to obtain a confirmation of consent all for participants.</p>" 
    	+ "<p>Please read the following statement: </p>" 
        + "<p>This experiment will ask you to listen to small musical excerpts then respond based on what you hear. The experiment is currently designed so that only trained musicians that understand moveable-do solfege can participate. You may choose not to participate or to withdraw from the study at any time without penalty or loss of any benefit.  "
   	+ "All data will be made anonymous and all efforts will be made to keep data private and secure. For questions concerning participant rights, feel free"
    	+ " to contact Dr. Dennis Landin, chair of the Institutional Review Board at either (225)-578-8692 or irb@lsu.edu.</p>"
        + "<p> If you are willing to partake in this study, please press NEXT and the survey will begin." ,

      	   '<p>Thank you for choosing to participate in this survey!</p>'  
    	        + "<p>Please answer the following survey questions about your aural skills background.</p>"],

    show_clickable_nav: true
  }

//    timeline.push(welcome_block);

/* Demographic Information */

var survey_trial_1 = {
  type: 'survey-text',
  questions: [{prompt: "How many years old are you?"}]
};


var survey_trial_2 = {
  type: 'survey-text',
  questions: [{prompt: "What is your educational status? (e.g. No Higher Education, Bachelor's, Masters Student, Finished Terminal Degree)"}]
};

var survey_trial_3 = {
  type: 'survey-text',
  questions: [{prompt: "Which type of syllable system do you prefer to use? (e.g. Moveable-Do, Fixed-Do, La-Based Minor, Numbers"}]
};

var survey_trial_4 = {
  type: 'survey-text',
  questions: [{prompt:"Do you have absolute pitch?"}]
};

var survey_trial_5 = {
  type: 'survey-text',
  questions: [{prompt: "How many weeks of aural skills training have you completed? (1 Semester = 15 weeks, 4 semesters = 60 weeks)"}]
};

var survey_trial_6 = {
  type: 'survey-text',
  questions: [{prompt: "How many years have you taught aural skills at the post-secondary level? (If you are an undergraduate student, please respond with 0)"}]
};


//timeline.push(survey_trial_1, survey_trial_2, survey_trial_3, survey_trial_4, survey_trial_5, survey_trial_6);


  var visual_melody_instructions_block = {
    type: 'instructions',
    pages: ["<p>Thank you for completing the first part of this experiment!</p>" +
	    "<p>Take a second to rest if you need, the NEXT portion of this survey will ask you to complete a very specific musical task.</p>",
          "<p>In this experiment you will complete the same task over many trials trials.</p>" 
    	+ "<p>In each section, will hear a short cadence played on the piano followed by one more more muscial tones.</p>" 
        + "<p>After hearing the tone or tones, you will be asked to respond which tone(s) you heard in moveable do notation as quickly and accurately as possible.</p>"         
        + "<p>There will be FIVE waves of tones, each corresponding to the number of tones you are asked to recall. This way, you will always know how many tones you need to respond with.</p>"         
        + "<p>The next section will provide an example so you understand the task.</p>",
	"<p>If you are ready to begin the example, please press NEXT.</p>"],

    show_clickable_nav: true
		};

//timeline.push(visual_melody_instructions_block);

  timeline.push({
    type: 'audio-button-response',
    stimulus: 'stimuli/long/c-do.mp3',
    choices: ['Do |  1', 'Ra | b2', 'Re | 2', 'Me | b3', 'Mi | 3', 'Fa | 4', 'Fi | #4', 'Sol | 5', 'Le | b6', 'La | 6', 'Te | b7', 'Ti | 7', 'Do | 1'],
    prompt: "<p>Which tone was played after the cadence?</p><p>The answer is 'Do' or '1'.</p>"
  });

  timeline.push({
    type: 'audio-button-response',
    stimulus: 'stimuli/long/a-le.mp3',
    choices: ['Do |  1', 'Ra | b2', 'Re | 2', 'Me | b3', 'Mi | 3', 'Fa | 4', 'Fi | #4', 'Sol | 5', 'Le | b6', 'La | 6', 'Te | b7', 'Ti | 7', 'Do | 1'],
    prompt: "<p>Which tone was played after the cadence?</p><p>The answer is 'Le' or 'b6'.</p>"
  });

  var check = {
    type: 'instructions',
    pages: ["<p>If you understand the task, please begin!</p>" +
	    "<p>If you do not understand the task, please close the web browser. Feel free to try the task, but participants who score below a certain accuracy threshold will be removed from the analysis.</p>",
          "<p>The 39 trials will begin as soon as you press NEXT.</p>" 
    	+ "<p>Trials are limited to 20 seconds, so the maximum amount of time it will take to complete this is experiment is 13 minutes. (20 seconds * 39 Stimuli = 780 seconds = 13 minutes)</p>" 
        + "<p>Thank you very much for your time!</p>"],

    show_clickable_nav: true
		};

//timeline.push(check);

var main_loop = {
	timeline: [
		{
    type: 'audio-button-response',
    stimulus: jsPsych.timelineVariable('melody'),
    choices: ['Do |  1', 'Ra | b2', 'Re | 2', 'Me | b3', 'Mi | 3', 'Fa | 4', 'Fi | #4', 'Sol | 5', 'Le | b6', 'La | 6', 'Te | b7', 'Ti | 7', 'Do | 1'],
    trial_duration: 20000,
    response_ends_trial: false,
    prompt: "<p>Which tone was played after the cadence?</p>"

		}
	],
	timeline_variables : [
	{ melody: 'stimuli/long/a-do.mp3' },
	{ melody: 'stimuli/long/a-do8.mp3' },
	{ melody: 'stimuli/long/a-fa.mp3' },
	{ melody: 'stimuli/long/a-fi.mp3' },
	{ melody: 'stimuli/long/a-la.mp3' },
	{ melody: 'stimuli/long/a-le.mp3' },
	{ melody: 'stimuli/long/a-me.mp3' },
	{ melody: 'stimuli/long/a-mi.mp3' },
	{ melody: 'stimuli/long/a-ra.mp3' },
	{ melody: 'stimuli/long/a-re.mp3' },
	{ melody: 'stimuli/long/a-sol.mp3' },
	{ melody: 'stimuli/long/a-te.mp3' },
	{ melody: 'stimuli/long/a-ti.mp3' },
	{ melody: 'stimuli/long/c-do.mp3' },
	{ melody: 'stimuli/long/c-do8.mp3' },
	{ melody: 'stimuli/long/c-fa.mp3' },
	{ melody: 'stimuli/long/c-fi.mp3' },
	{ melody: 'stimuli/long/c-la.mp3' },
	{ melody: 'stimuli/long/c-le.mp3' },
	{ melody: 'stimuli/long/c-me.mp3' },
	{ melody: 'stimuli/long/c-mi.mp3' },
	{ melody: 'stimuli/long/c-ra.mp3' },
	{ melody: 'stimuli/long/c-re.mp3' },
	{ melody: 'stimuli/long/c-sol.mp3' },
	{ melody: 'stimuli/long/c-ti.mp3' },
	{ melody: 'stimuli/long/e-di.mp3' },
	{ melody: 'stimuli/long/e-do.mp3' },
	{ melody: 'stimuli/long/e-do8.mp3' },
	{ melody: 'stimuli/long/e-fa.mp3' },
	{ melody: 'stimuli/long/e-fi.mp3' },
	{ melody: 'stimuli/long/e-la.mp3' },
	{ melody: 'stimuli/long/e-le.mp3' },
	{ melody: 'stimuli/long/e-me.mp3' },
	{ melody: 'stimuli/long/e-mi.mp3' },
	{ melody: 'stimuli/long/e-ra.mp3' },
	{ melody: 'stimuli/long/e-re.mp3' }, 
	{ melody: 'stimuli/long/e-sol.mp3' },
	{ melody: 'stimuli/long/e-te.mp3' },
	{ melody: 'stimuli/long/e-ti.mp3' },
	{ melody: 'stimuli/long/c-do.mp3' }, 
	{ melody: 'stimuli/long/c-do.mp3' }
],
	randomize_order: true

}

//timeline.push(main_loop);


/* This is where second wave will go  */

  var visual_melody_instructions_block_2 = {
    type: 'instructions',
    pages: ["<p>Thank you for completing the first set of responses!</p>" +
	    "<p>Take a second to rest if you need, in the NEXT portion of this experiment you will do the same task, but with <b>TWO</b> notes</p>",
         "<p>The next section will provide an example so you understand the task.</p>",
	"<p>If you are ready to begin the example, please press NEXT.</p>"],

    show_clickable_nav: true
		};

timeline.push(visual_melody_instructions_block_2);

var twoblock = {
    timeline: [
        {
            type: 'audio-button-response',
            stimulus: jsPsych.timelineVariable('melody'),
            choices: ['LISTEN'],
            prompt: "This is where I want my audio to play and they just listen with no response",
        },
        {
            type: 'html-button-response',
  	    stimulus: "<p>STIMULI</p>",
            choices: ['This would be a grid that collects multiple responses like trial examples before'],
            prompt: "<p>This scren will collect their responses in serial order with RT</p>" 
        }
    ],
    timeline_variables: [
	{ melody: 'stimuli/long/c-le.mp3' },
    ]
}

timeline.push(twoblock)

/* This is where second wave will end */ 

var subject_id = Math.floor(Math.random()*100000);
        jsPsych.data.addProperties({
                     subject: subject_id,
                });

    var bye_block = {
    type: 'instructions',
    pages: ["<p>Thank you very much for taking part in this !</p><p>PLEASE REMEMBER TO PRESS NEXT BELOW TO ENSURE YOUR DATA IS SAVED.</p><p>If you have any questions or would like to talk about this research, please email David at davidjohnbaker1 [at] gmail DOT com.</p>"],

    show_clickable_nav: true
  }

    timeline.push(bye_block);

/* Online Data Save Function */

function saveData(name, data){
  var xhr = new XMLHttpRequest();
  xhr.open('POST', 'write_data.php'); // 'write_data.php' is the path to the php file described above.
  xhr.setRequestHeader('Content-Type', 'application/json');
  xhr.send(JSON.stringify({filename: name, filedata: data}));
}


jsPsych.init({
   timeline: timeline,
   preload_audio:audio,
   on_finish: function() { saveData(subject_id,jsPsych.data.get().csv());}
    });

/* Local Save 
  jsPsych.init({
    timeline: timeline,
    preload_audio: audio,
    use_webaudio: true,
    on_finish: function(){jsPsych.data.displayData();}
  });
*/

  </script>
</html>

